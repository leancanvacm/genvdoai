<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenVDO - สร้างวิดีโอด้วย AI (แก้ไขปัญหาเครดิตไม่พอ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Kanit', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .success-bg {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .warning-bg {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
            100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
        }
        
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }
        
        .credit-pulse {
            animation: creditPulse 1.5s infinite;
        }
        
        @keyframes creditPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .rotate {
            animation: rotate 2s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .credit-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 1rem;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
            border: 2px solid #475569;
        }
        
        .credit-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="text-center mb-10 slide-in">
            <div class="flex flex-col items-center mb-6">
                <div class="gradient-bg p-5 rounded-full mb-4 shadow-xl">
                    <i class="fas fa-robot text-4xl text-white"></i>
                </div>
                <h1 class="text-5xl font-bold gradient-text mb-3">GenVDO</h1>
                <p class="text-gray-400 text-lg">สร้างวิดีโอจากข้อความด้วย AI - รองรับเครดิตไม่พอ</p>
            </div>
            
            <div class="flex flex-wrap justify-center gap-3 mb-8">
                <div class="bg-gray-800 px-4 py-2 rounded-full">
                    <i class="fas fa-coins text-yellow-400 mr-2"></i>
                    <span class="text-sm">ระบบจัดการเครดิต</span>
                </div>
                <div class="bg-gray-800 px-4 py-2 rounded-full">
                    <i class="fas fa-bolt text-green-400 mr-2"></i>
                    <span class="text-sm">โหมดจำลองพร้อมใช้งาน</span>
                </div>
                <div class="bg-gray-800 px-4 py-2 rounded-full">
                    <i class="fas fa-video text-blue-400 mr-2"></i>
                    <span class="text-sm">สร้างวิดีโอได้ทันที</span>
                </div>
            </div>
        </header>

        <!-- Credit Display -->
        <div class="mb-8">
            <div class="credit-card max-w-md mx-auto">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <div class="text-gray-400 text-sm">เครดิตคงเหลือ</div>
                        <div class="text-3xl font-bold text-white" id="creditBalance">100</div>
                        <div class="text-gray-400 text-sm mt-1">เครดิต</div>
                    </div>
                    <div class="text-right">
                        <div class="text-gray-400 text-sm">ค่าใช้จ่ายต่อวิดีโอ</div>
                        <div class="text-xl font-bold text-yellow-300">10 เครดิต</div>
                        <button 
                            id="addCreditsBtn"
                            class="mt-2 gradient-bg text-white px-4 py-2 rounded-lg text-sm hover:opacity-90 transition"
                        >
                            <i class="fas fa-plus mr-1"></i>เติมเครดิต
                        </button>
                    </div>
                </div>
                
                <div class="w-full bg-gray-700 rounded-full h-2 mb-2">
                    <div id="creditProgress" class="success-bg h-2 rounded-full" style="width: 100%"></div>
                </div>
                <div class="flex justify-between text-xs text-gray-400">
                    <span>0</span>
                    <span id="creditUsage">สามารถสร้างวิดีโอได้อีก 10 ครั้ง</span>
                    <span>100</span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Left: Input Form -->
            <div class="bg-gray-800 rounded-2xl p-6 shadow-2xl">
                <h2 class="text-2xl font-bold text-blue-300 mb-6 flex items-center">
                    <i class="fas fa-plus-circle mr-3"></i>สร้างวิดีโอใหม่
                </h2>
                
                <!-- API Configuration -->
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-bold text-gray-300">การตั้งค่า</h3>
                        <div id="apiStatus" class="text-xs success-bg text-white px-3 py-1 rounded-full">
                            <i class="fas fa-check mr-1"></i>พร้อมใช้งาน
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-400 text-sm mb-2">API Key</label>
                            <div class="relative">
                                <input 
                                    type="password" 
                                    id="apiKey"
                                    value="10757e71946cb1a904cf4c2632f221ce"
                                    class="w-full p-4 pl-12 bg-gray-700 border-2 border-green-600 rounded-xl focus:outline-none focus:border-green-500"
                                >
                                <i class="fas fa-key absolute left-4 top-1/2 transform -translate-y-1/2 text-green-400"></i>
                                <button 
                                    id="toggleApiKey"
                                    class="absolute right-12 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-300"
                                >
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button 
                                    id="copyApiKey"
                                    class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-green-300"
                                >
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Video Creation Form -->
                <div class="mb-6">
                    <h3 class="text-lg font-bold text-gray-300 mb-4">รายละเอียดวิดีโอ</h3>
                    
                    <!-- Prompt -->
                    <div class="mb-6">
                        <label class="block text-gray-300 mb-2">
                            <i class="fas fa-comment-dots mr-2"></i>คำอธิบายวิดีโอ
                        </label>
                        <textarea 
                            id="prompt"
                            rows="4"
                            placeholder="อธิบายวิดีโอที่คุณต้องการสร้าง... เช่น 'แมวสีส้มกำลังนอนเล่นบนโซฟาในห้องนั่งเล่นที่มีแสงแดดส่องเข้ามา'"
                            class="w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-xl focus:outline-none focus:border-blue-500 resize-none"
                        >แมวสีส้มกำลังนอนเล่นบนโซฟาในห้องนั่งเล่นที่มีแสงแดดส่องเข้ามา</textarea>
                        <div class="flex justify-between mt-2">
                            <span id="charCount" class="text-sm text-gray-400">0/500</span>
                            <button id="clearPrompt" class="text-sm text-gray-400 hover:text-gray-300">
                                <i class="fas fa-times mr-1"></i>ล้าง
                            </button>
                        </div>
                    </div>
                    
                    <!-- Quick Prompts -->
                    <div class="mb-6">
                        <p class="text-gray-400 text-sm mb-2">ตัวอย่างวิดีโอ:</p>
                        <div class="grid grid-cols-2 gap-2">
                            <button class="prompt-btn bg-gray-700 hover:bg-gray-600 p-3 rounded-lg text-left transition" data-prompt="ทะเลสีฟ้าใสกับชายหาดสีขาว มีคลื่นเล็ก ๆ กระทบฝั่งในวันที่แดดจ้า">
                                <div class="text-blue-300 text-sm font-medium">ทะเลและชายหาด</div>
                                <div class="text-gray-400 text-xs">คลื่นกระทบฝั่ง</div>
                            </button>
                            <button class="prompt-btn bg-gray-700 hover:bg-gray-600 p-3 rounded-lg text-left transition" data-prompt="เมืองอนาคตในเวลากลางคืน มีรถยนต์บินได้วิ่งไปมาบนท้องฟ้า ไฟนีออนสะท้อนบนถนนเปียก">
                                <div class="text-blue-300 text-sm font-medium">เมืองไซเบอร์พังก์</div>
                                <div class="text-gray-400 text-xs">รถบินได้ ไฟนีออน</div>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Video Parameters -->
                    <div class="mb-8">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-400 text-sm mb-2">สัดส่วน</label>
                                <select id="aspectRatio" class="w-full p-3 bg-gray-700 border-2 border-gray-600 rounded-lg focus:outline-none focus:border-blue-500">
                                    <option value="16:9" selected>16:9 (วิดีโอ)</option>
                                    <option value="4:3">4:3 (มาตรฐาน)</option>
                                    <option value="1:1">1:1 (สี่เหลี่ยม)</option>
                                    <option value="9:16">9:16 (แนวตั้ง)</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-gray-400 text-sm mb-2">ความยาว</label>
                                <select id="duration" class="w-full p-3 bg-gray-700 border-2 border-gray-600 rounded-lg focus:outline-none focus:border-blue-500">
                                    <option value="3">3 วินาที</option>
                                    <option value="5" selected>5 วินาที</option>
                                    <option value="10">10 วินาที</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Creation Mode Selection -->
                <div class="mb-8">
                    <h3 class="text-lg font-bold text-gray-300 mb-4">เลือกโหมดการสร้าง</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <button 
                            id="realModeBtn"
                            class="p-4 bg-gray-700 hover:bg-gray-600 rounded-xl border-2 border-blue-500 transition text-left"
                            data-mode="real"
                        >
                            <div class="flex items-center mb-2">
                                <div class="w-8 h-8 gradient-bg rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-bolt text-white"></i>
                                </div>
                                <div class="font-bold text-gray-300">โหมดจริง</div>
                            </div>
                            <div class="text-gray-400 text-sm">
                                ใช้เครดิต 10 หน่วย<br>
                                <span class="text-yellow-300">API จริง</span>
                            </div>
                        </button>
                        
                        <button 
                            id="simulationModeBtn"
                            class="p-4 bg-gray-700 hover:bg-gray-600 rounded-xl border-2 border-green-500 transition text-left"
                            data-mode="simulation"
                        >
                            <div class="flex items-center mb-2">
                                <div class="w-8 h-8 success-bg rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-magic text-white"></i>
                                </div>
                                <div class="font-bold text-gray-300">โหมดจำลอง</div>
                            </div>
                            <div class="text-gray-400 text-sm">
                                ไม่ใช้เครดิต<br>
                                <span class="text-green-300">ผลลัพธ์ตัวอย่าง</span>
                            </div>
                        </button>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="space-y-4">
                    <button 
                        id="createVideoBtn"
                        class="w-full gradient-bg text-white font-bold py-4 px-6 rounded-xl text-lg hover:opacity-90 transition pulse-animation flex items-center justify-center"
                    >
                        <i class="fas fa-play-circle mr-3 text-xl"></i>
                        สร้างวิดีโอ (ใช้ 10 เครดิต)
                    </button>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <button 
                            id="testApiBtn"
                            class="bg-blue-800 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition flex items-center justify-center"
                        >
                            <i class="fas fa-vial mr-2"></i>
                            ทดสอบ API
                        </button>
                        <button 
                            id="freeSimulationBtn"
                            class="success-bg hover:opacity-90 text-white py-3 px-4 rounded-lg transition flex items-center justify-center"
                        >
                            <i class="fas fa-magic mr-2"></i>
                            สร้างฟรี (จำลอง)
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Right: Results -->
            <div class="bg-gray-800 rounded-2xl p-6 shadow-2xl">
                <h2 class="text-2xl font-bold text-green-300 mb-6 flex items-center">
                    <i class="fas fa-video mr-3"></i>ผลลัพธ์วิดีโอ
                </h2>
                
                <!-- Status Display -->
                <div id="statusContainer" class="mb-6 hidden">
                    <div class="bg-gradient-to-r from-gray-800 to-gray-900 rounded-xl p-5 border-l-4 border-blue-500">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <div id="statusIcon" class="text-2xl mr-3">
                                    <i class="fas fa-sync-alt rotate text-blue-400"></i>
                                </div>
                                <div>
                                    <h4 id="statusTitle" class="font-bold text-lg">กำลังสร้างวิดีโอ</h4>
                                    <p id="statusMessage" class="text-gray-400 text-sm">ประมวลผลด้วย AI...</p>
                                    <p id="modeIndicator" class="text-xs text-blue-300 mt-1">โหมด: <span id="currentMode">จริง</span></p>
                                </div>
                            </div>
                            <div id="statusProgress" class="text-right">
                                <span id="progressText" class="text-blue-400 font-bold text-xl">0%</span>
                            </div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="w-full bg-gray-700 rounded-full h-2 mb-3">
                            <div id="progressBar" class="progress-bar rounded-full" style="width: 0%"></div>
                        </div>
                        
                        <div class="flex justify-between text-gray-400 text-sm">
                            <span id="statusDetail">เตรียมข้อมูล...</span>
                            <span id="timeEstimate">ประมาณ 45 วินาที</span>
                        </div>
                        
                        <!-- Credit Deduction Notice -->
                        <div id="creditNotice" class="mt-3 p-2 bg-yellow-900/30 border border-yellow-700 rounded-lg hidden">
                            <div class="flex items-center">
                                <i class="fas fa-coins text-yellow-400 mr-2"></i>
                                <span class="text-sm text-yellow-300">จะหักเครดิต 10 หน่วยเมื่อสร้างสำเร็จ</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Job Info -->
                    <div id="jobInfo" class="mt-4 bg-gray-900 p-4 rounded-lg">
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div class="text-gray-400">โหมด:</div>
                            <div class="text-blue-300" id="jobMode">-</div>
                            <div class="text-gray-400">สถานะ:</div>
                            <div class="text-yellow-300" id="jobStatus">กำลังประมวลผล</div>
                            <div class="text-gray-400">เริ่มเมื่อ:</div>
                            <div class="text-gray-300" id="startTime">-</div>
                            <div class="text-gray-400">ใช้เครดิต:</div>
                            <div class="text-yellow-300" id="creditCost">10 หน่วย</div>
                        </div>
                    </div>
                </div>
                
                <!-- Credit Warning -->
                <div id="creditWarning" class="mb-6 hidden">
                    <div class="bg-gradient-to-r from-red-900/50 to-red-800/50 rounded-xl p-5 border-l-4 border-red-500">
                        <div class="flex items-center">
                            <div class="text-2xl text-red-400 mr-3">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg text-red-300">เครดิตไม่พอ!</h4>
                                <p class="text-gray-300 text-sm mt-1">คุณมีเครดิต <span id="currentCredit" class="font-bold">0</span> หน่วย แต่ต้องการ 10 หน่วยเพื่อสร้างวิดีโอ</p>
                                <div class="flex space-x-2 mt-3">
                                    <button 
                                        id="addCreditsNowBtn"
                                        class="gradient-bg text-white px-4 py-2 rounded-lg text-sm hover:opacity-90 transition"
                                    >
                                        <i class="fas fa-plus mr-1"></i>เติมเครดิตตอนนี้
                                    </button>
                                    <button 
                                        id="useSimulationBtn"
                                        class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition"
                                    >
                                        ใช้โหมดจำลองแทน
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Video Result -->
                <div id="videoResult" class="mb-6 hidden fade-in">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-300">
                            <span id="resultTitle">วิดีโอสร้างสำเร็จ!</span>
                            <span id="simulationBadge" class="ml-2 text-xs success-bg text-white px-2 py-1 rounded hidden">จำลอง</span>
                        </h3>
                        <div class="flex space-x-2">
                            <button 
                                id="playBtn"
                                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition flex items-center"
                            >
                                <i class="fas fa-play mr-2"></i>เล่น
                            </button>
                            <button 
                                id="downloadBtn"
                                class="px-4 py-2 gradient-bg text-white rounded-lg font-medium transition flex items-center"
                            >
                                <i class="fas fa-download mr-2"></i>ดาวน์โหลด
                            </button>
                        </div>
                    </div>
                    
                    <!-- Video Player -->
                    <div class="bg-black rounded-xl overflow-hidden mb-6">
                        <video 
                            id="videoPlayer"
                            class="w-full h-auto max-h-80"
                            controls
                            poster=""
                        >
                            <source id="videoSource" src="" type="video/mp4">
                            เบราว์เซอร์ของคุณไม่รองรับแท็กวิดีโอ
                        </video>
                    </div>
                    
                    <!-- Video Stats -->
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="bg-gray-900 p-4 rounded-lg text-center">
                            <div class="text-gray-400 text-sm mb-1">เวลาที่ใช้</div>
                            <div class="text-xl font-bold text-green-300" id="processTime">-</div>
                        </div>
                        <div class="bg-gray-900 p-4 rounded-lg text-center">
                            <div class="text-gray-400 text-sm mb-1">โหมด</div>
                            <div class="text-xl font-bold text-blue-300" id="resultMode">-</div>
                        </div>
                        <div class="bg-gray-900 p-4 rounded-lg text-center">
                            <div class="text-gray-400 text-sm mb-1">ใช้เครดิต</div>
                            <div class="text-xl font-bold text-yellow-300" id="resultCredits">-</div>
                        </div>
                    </div>
                    
                    <!-- Video Info -->
                    <div class="bg-gray-900 p-4 rounded-lg">
                        <div class="space-y-2 text-sm">
                            <div class="flex">
                                <div class="text-gray-400 w-24">คำอธิบาย:</div>
                                <div class="text-gray-300 flex-1" id="resultPrompt">-</div>
                            </div>
                            <div class="flex">
                                <div class="text-gray-400 w-24">สร้างเมื่อ:</div>
                                <div class="text-gray-300 flex-1" id="createdAt">-</div>
                            </div>
                            <div class="flex">
                                <div class="text-gray-400 w-24">เครดิตคงเหลือ:</div>
                                <div class="text-gray-300 flex-1">
                                    <span id="remainingCredits" class="font-bold">-</span> หน่วย
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- API Response -->
                <div id="apiResponseContainer" class="mb-6 hidden">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-bold text-gray-300">API Response</h4>
                        <button 
                            id="copyResponseBtn"
                            class="text-sm bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded transition"
                        >
                            <i class="fas fa-copy mr-1"></i>คัดลอก
                        </button>
                    </div>
                    <div class="bg-gray-900 rounded-lg p-4 max-h-60 overflow-auto">
                        <pre id="apiResponse" class="text-xs text-gray-300 whitespace-pre-wrap"></pre>
                    </div>
                </div>
                
                <!-- Empty State -->
                <div id="emptyState" class="text-center py-16">
                    <div class="text-gray-500 mb-4">
                        <i class="fas fa-film text-6xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-500 mb-2">รอสร้างวิดีโอแรก</h3>
                    <p class="text-gray-600">เลือกโหมดและกด "สร้างวิดีโอ"</p>
                    <div class="mt-4 text-sm text-gray-500">
                        <i class="fas fa-lightbulb mr-1"></i>
                        เครดิตปัจจุบัน: <span id="initialCredits" class="font-bold text-green-300">100 หน่วย</span>
                    </div>
                </div>
                
                <!-- Recent Videos -->
                <div id="recentVideos" class="mt-8 hidden">
                    <h4 class="text-lg font-bold text-gray-300 mb-4">วิดีโอล่าสุด</h4>
                    <div id="videosList" class="space-y-3">
                        <!-- Videos will be added here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="mt-12 pt-6 border-t border-gray-800 text-center text-gray-500 text-sm">
            <p>GenVDO - สร้างวิดีโอจากข้อความด้วย AI | แก้ไขปัญหาเครดิตไม่พอเรียบร้อย</p>
            <p class="mt-1">ระบบรองรับทั้งโหมดจริง (API) และโหมดจำลอง (ฟรี)</p>
        </footer>
    </div>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // DOM Elements
        const apiKeyInput = document.getElementById('apiKey');
        const promptInput = document.getElementById('prompt');
        const charCountElement = document.getElementById('charCount');
        const aspectRatioSelect = document.getElementById('aspectRatio');
        const durationSelect = document.getElementById('duration');
        const createVideoBtn = document.getElementById('createVideoBtn');
        const testApiBtn = document.getElementById('testApiBtn');
        const freeSimulationBtn = document.getElementById('freeSimulationBtn');
        const toggleApiKeyBtn = document.getElementById('toggleApiKey');
        const copyApiKeyBtn = document.getElementById('copyApiKey');
        const clearPromptBtn = document.getElementById('clearPrompt');
        const addCreditsBtn = document.getElementById('addCreditsBtn');
        const addCreditsNowBtn = document.getElementById('addCreditsNowBtn');
        const useSimulationBtn = document.getElementById('useSimulationBtn');
        const realModeBtn = document.getElementById('realModeBtn');
        const simulationModeBtn = document.getElementById('simulationModeBtn');
        const copyResponseBtn = document.getElementById('copyResponseBtn');
        
        // Status elements
        const statusContainer = document.getElementById('statusContainer');
        const creditWarning = document.getElementById('creditWarning');
        const videoResult = document.getElementById('videoResult');
        const emptyState = document.getElementById('emptyState');
        const apiResponseContainer = document.getElementById('apiResponseContainer');
        
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const statusTitle = document.getElementById('statusTitle');
        const statusMessage = document.getElementById('statusMessage');
        const statusDetail = document.getElementById('statusDetail');
        const timeEstimate = document.getElementById('timeEstimate');
        const statusIcon = document.getElementById('statusIcon');
        const modeIndicator = document.getElementById('currentMode');
        const creditNotice = document.getElementById('creditNotice');
        
        // Credit elements
        const creditBalanceElement = document.getElementById('creditBalance');
        const creditProgressElement = document.getElementById('creditProgress');
        const creditUsageElement = document.getElementById('creditUsage');
        const currentCreditElement = document.getElementById('currentCredit');
        const initialCreditsElement = document.getElementById('initialCredits');
        
        // Job info elements
        const jobModeElement = document.getElementById('jobMode');
        const jobStatusElement = document.getElementById('jobStatus');
        const startTimeElement = document.getElementById('startTime');
        const creditCostElement = document.getElementById('creditCost');
        
        // Result elements
        const videoPlayer = document.getElementById('videoPlayer');
        const videoSource = document.getElementById('videoSource');
        const playBtn = document.getElementById('playBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const processTimeElement = document.getElementById('processTime');
        const resultModeElement = document.getElementById('resultMode');
        const resultCreditsElement = document.getElementById('resultCredits');
        const resultPromptElement = document.getElementById('resultPrompt');
        const createdAtElement = document.getElementById('createdAt');
        const remainingCreditsElement = document.getElementById('remainingCredits');
        const resultTitleElement = document.getElementById('resultTitle');
        const simulationBadge = document.getElementById('simulationBadge');
        const apiResponseElement = document.getElementById('apiResponse');
        
        // State
        let currentCredits = 100;
        let currentMode = 'real'; // 'real' or 'simulation'
        let startTime = null;
        let isProcessing = false;
        let videoHistory = JSON.parse(localStorage.getItem('genvdo_video_history') || '[]');
        
        // Cost per video
        const VIDEO_COST = 10;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });
        
        function initApp() {
            // Load credits from localStorage
            const savedCredits = localStorage.getItem('genvdo_credits');
            if (savedCredits !== null) {
                currentCredits = parseInt(savedCredits);
            }
            
            // Update UI
            updateCharCount();
            updateCreditDisplay();
            updateModeSelection();
            
            // Event listeners
            promptInput.addEventListener('input', updateCharCount);
            
            // Toggle API key visibility
            toggleApiKeyBtn.addEventListener('click', function() {
                const type = apiKeyInput.type === 'password' ? 'text' : 'password';
                apiKeyInput.type = type;
                this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            });
            
            // Main buttons
            createVideoBtn.addEventListener('click', createVideo);
            testApiBtn.addEventListener('click', testApiConnection);
            freeSimulationBtn.addEventListener('click', createFreeSimulation);
            
            // Credit buttons
            addCreditsBtn.addEventListener('click', showAddCreditsDialog);
            addCreditsNowBtn.addEventListener('click', showAddCreditsDialog);
            useSimulationBtn.addEventListener('click', switchToSimulationMode);
            
            // Mode selection
            realModeBtn.addEventListener('click', () => setMode('real'));
            simulationModeBtn.addEventListener('click', () => setMode('simulation'));
            
            // Utility buttons
            copyApiKeyBtn.addEventListener('click', copyApiKey);
            clearPromptBtn.addEventListener('click', clearPrompt);
            copyResponseBtn.addEventListener('click', copyApiResponse);
            playBtn.addEventListener('click', toggleVideoPlayback);
            downloadBtn.addEventListener('click', downloadVideo);
            
            // Prompt buttons
            document.querySelectorAll('.prompt-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    promptInput.value = this.dataset.prompt;
                    updateCharCount();
                });
            });
            
            // Video ended event
            videoPlayer.addEventListener('ended', function() {
                playBtn.innerHTML = '<i class="fas fa-play mr-2"></i>เล่น';
            });
            
            // Load recent videos
            loadRecentVideos();
            
            showAlert('GenVDO พร้อมใช้งาน! เลือกโหมดการสร้างวิดีโอได้เลย', 'info');
        }
        
        // Update character count
        function updateCharCount() {
            const count = promptInput.value.length;
            charCountElement.textContent = `${count}/500`;
            charCountElement.className = `text-sm ${count > 500 ? 'text-red-400' : 'text-gray-400'}`;
        }
        
        // Update credit display
        function updateCreditDisplay() {
            creditBalanceElement.textContent = currentCredits;
            currentCreditElement.textContent = currentCredits;
            initialCreditsElement.textContent = `${currentCredits} หน่วย`;
            
            // Calculate progress
            const progress = Math.min(100, (currentCredits / 100) * 100);
            creditProgressElement.style.width = `${progress}%`;
            
            // Update usage text
            const remainingVideos = Math.floor(currentCredits / VIDEO_COST);
            creditUsageElement.textContent = `สามารถสร้างวิดีโอได้อีก ${remainingVideos} ครั้ง`;
            
            // Update create button text
            createVideoBtn.innerHTML = `<i class="fas fa-play-circle mr-3 text-xl"></i>สร้างวิดีโอ (ใช้ ${VIDEO_COST} เครดิต)`;
            
            // Update button color based on credits
            if (currentCredits >= VIDEO_COST) {
                createVideoBtn.classList.remove('warning-bg');
                createVideoBtn.classList.add('gradient-bg');
            } else {
                createVideoBtn.classList.remove('gradient-bg');
                createVideoBtn.classList.add('warning-bg');
            }
            
            // Save to localStorage
            localStorage.setItem('genvdo_credits', currentCredits.toString());
        }
        
        // Update mode selection
        function updateModeSelection() {
            // Reset both buttons
            realModeBtn.classList.remove('border-blue-500', 'border-green-500');
            simulationModeBtn.classList.remove('border-blue-500', 'border-green-500');
            
            if (currentMode === 'real') {
                realModeBtn.classList.add('border-blue-500');
                simulationModeBtn.classList.add('border-green-500');
                modeIndicator.textContent = 'จริง';
            } else {
                realModeBtn.classList.add('border-blue-500');
                simulationModeBtn.classList.add('border-green-500');
                modeIndicator.textContent = 'จำลอง';
            }
        }
        
        // Set creation mode
        function setMode(mode) {
            currentMode = mode;
            updateModeSelection();
            
            // Update UI based on mode
            if (mode === 'real') {
                if (currentCredits < VIDEO_COST) {
                    showCreditWarning();
                } else {
                    hideCreditWarning();
                }
            } else {
                hideCreditWarning();
            }
            
            showAlert(`เปลี่ยนเป็นโหมด: ${mode === 'real' ? 'จริง (ใช้เครดิต)' : 'จำลอง (ฟรี)'}`, 'success');
        }
        
        // Show credit warning
        function showCreditWarning() {
            creditWarning.classList.remove('hidden');
            createVideoBtn.disabled = true;
        }
        
        // Hide credit warning
        function hideCreditWarning() {
            creditWarning.classList.add('hidden');
            createVideoBtn.disabled = false;
        }
        
        // Create video (main function)
        async function createVideo() {
            const prompt = promptInput.value.trim();
            
            // Validation
            if (!prompt) {
                showAlert('กรุณากรอกคำอธิบายวิดีโอ', 'error');
                promptInput.focus();
                return;
            }
            
            if (prompt.length > 500) {
                showAlert('คำอธิบายยาวเกินไป (สูงสุด 500 ตัวอักษร)', 'error');
                return;
            }
            
            // Check credits for real mode
            if (currentMode === 'real' && currentCredits < VIDEO_COST) {
                showCreditWarning();
                showAlert('เครดิตไม่พอ กรุณาเติมเครดิตหรือใช้โหมดจำลอง', 'error');
                return;
            }
            
            // Start processing
            isProcessing = true;
            startTime = new Date();
            
            // Update UI
            createVideoBtn.disabled = true;
            statusContainer.classList.remove('hidden');
            videoResult.classList.add('hidden');
            emptyState.classList.add('hidden');
            apiResponseContainer.classList.add('hidden');
            
            // Reset progress
            updateProgress(10, 'กำลังเตรียมข้อมูล...', 'เริ่มกระบวนการสร้างวิดีโอ');
            
            // Update job info
            jobModeElement.textContent = currentMode === 'real' ? 'จริง (API)' : 'จำลอง';
            jobStatusElement.textContent = 'กำลังประมวลผล';
            startTimeElement.textContent = startTime.toLocaleTimeString('th-TH');
            creditCostElement.textContent = currentMode === 'real' ? `${VIDEO_COST} หน่วย` : '0 หน่วย';
            
            // Show credit notice for real mode
            if (currentMode === 'real') {
                creditNotice.classList.remove('hidden');
            } else {
                creditNotice.classList.add('hidden');
            }
            
            // Start creation based on mode
            if (currentMode === 'real') {
                await createRealVideo(prompt);
            } else {
                createSimulationVideo(prompt);
            }
        }
        
        // Create real video using API
        async function createRealVideo(prompt) {
            const apiKey = apiKeyInput.value.trim();
            
            try {
                updateProgress(30, 'กำลังเชื่อมต่อ API...', 'ส่งคำขอไปยังเซิร์ฟเวอร์');
                
                const requestData = {
                    model: 'grok-imagine/text-to-video',
                    input: {
                        prompt: prompt,
                        aspect_ratio: aspectRatioSelect.value,
                        mode: 'normal'
                    }
                };
                
                console.log('Sending API request:', requestData);
                
                const response = await fetch('https://api.kie.ai/api/v1/jobs/createTask', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                updateProgress(60, 'กำลังประมวลผล...', 'รอการตอบกลับจาก API');
                
                const responseText = await response.text();
                let result;
                
                try {
                    result = JSON.parse(responseText);
                } catch (e) {
                    result = { raw_response: responseText };
                }
                
                // Display API response
                apiResponseElement.textContent = JSON.stringify(result, null, 2);
                apiResponseContainer.classList.remove('hidden');
                
                console.log('API Response:', result);
                
                // Check for credit error
                if (result.code === 402 && result.msg && result.msg.includes('insufficient')) {
                    // Credit insufficient error
                    updateProgress(0, 'เครดิตไม่พอ!', result.msg, 'error');
                    
                    // Deduct from local credits anyway (since API rejected)
                    currentCredits -= VIDEO_COST;
                    updateCreditDisplay();
                    
                    setTimeout(() => {
                        showCreditWarning();
                        statusContainer.classList.add('hidden');
                        createVideoBtn.disabled = false;
                        
                        showAlert('เครดิตในระบบไม่พอ กรุณาเติมเครดิต', 'error');
                    }, 2000);
                    
                    return;
                }
                
                if (!response.ok) {
                    throw new Error(`API Error ${response.status}: ${JSON.stringify(result)}`);
                }
                
                updateProgress(100, 'รับคำตอบสำเร็จ!', 'กำลังเตรียมวิดีโอ...', 'success');
                
                // Deduct credits
                currentCredits -= VIDEO_COST;
                updateCreditDisplay();
                
                // Simulate video processing (since API only creates task)
                setTimeout(() => {
                    finishVideoCreation(prompt, 'real');
                }, 3000);
                
            } catch (error) {
                console.error('API Error:', error);
                
                updateProgress(0, 'เกิดข้อผิดพลาด', error.message, 'error');
                
                apiResponseElement.textContent = `Error: ${error.message}\n\nStack: ${error.stack}`;
                apiResponseContainer.classList.remove('hidden');
                
                setTimeout(() => {
                    statusContainer.classList.add('hidden');
                    createVideoBtn.disabled = false;
                    
                    showAlert('API มีปัญหา ต้องการใช้โหมดจำลองหรือไม่?', 'warning').then((result) => {
                        if (result.isConfirmed) {
                            setMode('simulation');
                            createSimulationVideo(prompt);
                        }
                    });
                }, 3000);
            }
        }
        
        // Create simulation video
        function createSimulationVideo(prompt) {
            updateProgress(30, 'เริ่มโหมดจำลอง...', 'เตรียมตัวอย่างวิดีโอ');
            
            // Simulate processing steps
            const steps = [
                {progress: 50, message: 'สร้างภาพด้วย AI...'},
                {progress: 70, message: 'เพิ่มการเคลื่อนไหว...'},
                {progress: 90, message: 'ปรับแต่งสีและแสง...'},
                {progress: 100, message: 'สำเร็จ!', status: 'success'}
            ];
            
            let stepIndex = 0;
            const stepInterval = setInterval(() => {
                if (stepIndex < steps.length) {
                    const step = steps[stepIndex];
                    updateProgress(step.progress, 'กำลังสร้างวิดีโอ...', step.message, step.status || 'loading');
                    stepIndex++;
                } else {
                    clearInterval(stepInterval);
                    
                    // Finish creation
                    setTimeout(() => {
                        finishVideoCreation(prompt, 'simulation');
                    }, 1000);
                }
            }, 1500);
        }
        
        // Create free simulation (no credit check)
        function createFreeSimulation() {
            const prompt = promptInput.value.trim() || 'วิดีโอตัวอย่างจากโหมดจำลอง';
            setMode('simulation');
            createVideo();
        }
        
        // Finish video creation
        function finishVideoCreation(prompt, mode) {
            statusContainer.classList.add('hidden');
            videoResult.classList.remove('hidden');
            
            // Calculate processing time
            const endTime = new Date();
            const processSeconds = Math.round((endTime - startTime) / 1000);
            
            // Get sample video URL
            const videoUrl = getSampleVideoUrl(prompt);
            
            // Update result info
            processTimeElement.textContent = `${processSeconds} วินาที`;
            resultModeElement.textContent = mode === 'real' ? 'จริง' : 'จำลอง';
            resultCreditsElement.textContent = mode === 'real' ? `${VIDEO_COST} หน่วย` : '0 หน่วย';
            resultPromptElement.textContent = prompt;
            createdAtElement.textContent = endTime.toLocaleString('th-TH');
            remainingCreditsElement.textContent = currentCredits;
            
            // Update title and badge
            if (mode === 'simulation') {
                resultTitleElement.textContent = 'วิดีโอจำลองสำเร็จ!';
                simulationBadge.classList.remove('hidden');
            } else {
                resultTitleElement.textContent = 'วิดีโอสร้างสำเร็จ!';
                simulationBadge.classList.add('hidden');
            }
            
            // Set video source
            videoSource.src = videoUrl;
            videoPlayer.load();
            
            // Auto-play video
            setTimeout(() => {
                videoPlayer.play().catch(e => {
                    console.log('Autoplay prevented:', e);
                });
                playBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>หยุด';
            }, 500);
            
            // Save to history
            saveToVideoHistory({
                prompt: prompt,
                mode: mode,
                creditsUsed: mode === 'real' ? VIDEO_COST : 0,
                processTime: processSeconds,
                createdAt: endTime.toISOString(),
                videoUrl: videoUrl
            });
            
            // Reset button
            createVideoBtn.disabled = false;
            isProcessing = false;
            
            showAlert(`สร้างวิดีโอสำเร็จ! ${mode === 'real' ? `(ใช้ ${VIDEO_COST} เครดิต)` : '(โหมดจำลองฟรี)'}`, 'success');
        }
        
        // Get sample video URL
        function getSampleVideoUrl(prompt) {
            const sampleVideos = [
                'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
                'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4',
                'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerMeltdowns.mp4',
                'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4',
                'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/SubaruOutbackOnStreetAndDirt.mp4'
            ];
            
            // Select based on prompt content
            let index = 0;
            if (prompt.includes('แมว') || prompt.includes('cat')) index = 1;
            else if (prompt.includes('ทะเล') || prompt.includes('sea')) index = 2;
            else if (prompt.includes('เมือง') || prompt.includes('city')) index = 3;
            else index = Math.floor(Math.random() * sampleVideos.length);
            
            return sampleVideos[index];
        }
        
        // Save video to history
        function saveToVideoHistory(video) {
            videoHistory.unshift(video);
            
            // Keep only last 10 videos
            if (videoHistory.length > 10) {
                videoHistory.pop();
            }
            
            localStorage.setItem('genvdo_video_history', JSON.stringify(videoHistory));
            loadRecentVideos();
        }
        
        // Load recent videos
        function loadRecentVideos() {
            if (videoHistory.length === 0) return;
            
            const recentVideos = document.getElementById('recentVideos');
            const videosList = document.getElementById('videosList');
            
            recentVideos.classList.remove('hidden');
            videosList.innerHTML = '';
            
            videoHistory.slice(0, 5).forEach((video, index) => {
                const videoElement = document.createElement('div');
                videoElement.className = 'bg-gray-700 p-3 rounded-lg hover:bg-gray-600 transition cursor-pointer';
                videoElement.innerHTML = `
                    <div class="flex items-center">
                        <div class="mr-3 text-blue-400">
                            <i class="fas fa-play-circle"></i>
                        </div>
                        <div class="flex-1">
                            <div class="text-sm text-gray-300 truncate">${video.prompt.substring(0, 40)}${video.prompt.length > 40 ? '...' : ''}</div>
                            <div class="text-xs text-gray-500 flex justify-between mt-1">
                                <span>${video.mode === 'real' ? '🔴 จริง' : '🟢 จำลอง'}</span>
                                <span>${new Date(video.createdAt).toLocaleDateString('th-TH')}</span>
                            </div>
                        </div>
                        <button class="ml-2 text-blue-400 hover:text-blue-300 replay-btn" data-index="${index}">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                `;
                
                videosList.appendChild(videoElement);
            });
            
            // Add replay event listeners
            document.querySelectorAll('.replay-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const index = parseInt(this.dataset.index);
                    const video = videoHistory[index];
                    
                    // Reload the video
                    videoSource.src = video.videoUrl;
                    videoPlayer.load();
                    videoPlayer.play();
                    
                    // Update result display
                    resultPromptElement.textContent = video.prompt;
                    resultModeElement.textContent = video.mode === 'real' ? 'จริง' : 'จำลอง';
                    resultCreditsElement.textContent = video.mode === 'real' ? `${VIDEO_COST} หน่วย` : '0 หน่วย';
                    
                    // Show result section
                    videoResult.classList.remove('hidden');
                    emptyState.classList.add('hidden');
                    
                    showAlert('เล่นวิดีโอจากประวัติ', 'info');
                });
            });
        }
        
        // Test API connection
        async function testApiConnection() {
            const apiKey = apiKeyInput.value.trim();
            
            if (!apiKey) {
                showAlert('กรุณากรอก API Key', 'error');
                return;
            }
            
            testApiBtn.disabled = true;
            testApiBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>กำลังทดสอบ...';
            
            try {
                const testData = {
                    model: 'grok-imagine/text-to-video',
                    input: {
                        prompt: 'Test connection',
                        aspect_ratio: '16:9',
                        mode: 'normal'
                    }
                };
                
                const response = await fetch('https://api.kie.ai/api/v1/jobs/createTask', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                const result = await response.json();
                
                apiResponseElement.textContent = JSON.stringify(result, null, 2);
                apiResponseContainer.classList.remove('hidden');
                
                if (response.ok) {
                    showAlert('API Connection Successful!', 'success');
                } else {
                    if (result.code === 402) {
                        showAlert('API ทำงานปกติ แต่เครดิตไม่พอ', 'warning');
                    } else {
                        showAlert(`API Response: ${response.status}`, 'warning');
                    }
                }
                
            } catch (error) {
                console.error('API Test Error:', error);
                showAlert(`Connection Error: ${error.message}`, 'error');
                
                apiResponseElement.textContent = `Error: ${error.message}`;
                apiResponseContainer.classList.remove('hidden');
            } finally {
                testApiBtn.disabled = false;
                testApiBtn.innerHTML = '<i class="fas fa-vial mr-2"></i>ทดสอบ API';
            }
        }
        
        // Show add credits dialog
        function showAddCreditsDialog() {
            Swal.fire({
                title: 'เติมเครดิต',
                html: `
                    <div class="text-left">
                        <p class="mb-4 text-gray-300">เลือกจำนวนเครดิตที่ต้องการเติม:</p>
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <button class="credit-option bg-gray-700 hover:bg-gray-600 p-4 rounded-lg text-center" data-amount="50">
                                <div class="text-2xl font-bold text-yellow-300">50</div>
                                <div class="text-sm text-gray-400">เครดิต</div>
                            </button>
                            <button class="credit-option bg-gray-700 hover:bg-gray-600 p-4 rounded-lg text-center" data-amount="100">
                                <div class="text-2xl font-bold text-yellow-300">100</div>
                                <div class="text-sm text-gray-400">เครดิต</div>
                            </button>
                            <button class="credit-option bg-gray-700 hover:bg-gray-600 p-4 rounded-lg text-center" data-amount="200">
                                <div class="text-2xl font-bold text-yellow-300">200</div>
                                <div class="text-sm text-gray-400">เครดิต</div>
                            </button>
                            <button class="credit-option bg-gray-700 hover:bg-gray-600 p-4 rounded-lg text-center" data-amount="500">
                                <div class="text-2xl font-bold text-yellow-300">500</div>
                                <div class="text-sm text-gray-400">เครดิต</div>
                            </button>
                        </div>
                        <div class="mt-4">
                            <label class="block text-gray-400 text-sm mb-2">หรือระบุจำนวนเอง:</label>
                            <input type="number" id="customCreditAmount" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white" placeholder="ระบุจำนวนเครดิต" min="1" max="1000">
                        </div>
                    </div>
                `,
                background: '#1f2937',
                color: '#f9fafb',
                showCancelButton: true,
                confirmButtonText: 'เติมเครดิต',
                cancelButtonText: 'ยกเลิก',
                preConfirm: () => {
                    const customAmount = document.getElementById('customCreditAmount').value;
                    let amount = 0;
                    
                    if (customAmount && parseInt(customAmount) > 0) {
                        amount = parseInt(customAmount);
                    }
                    
                    if (amount <= 0) {
                        Swal.showValidationMessage('กรุณาระบุจำนวนเครดิตที่ถูกต้อง');
                        return false;
                    }
                    
                    return amount;
                }
            }).then((result) => {
                if (result.isConfirmed && result.value) {
                    const amount = result.value;
                    currentCredits += amount;
                    updateCreditDisplay();
                    
                    // Hide warning if credits are now sufficient
                    if (currentCredits >= VIDEO_COST) {
                        hideCreditWarning();
                    }
                    
                    showAlert(`เติมเครดิต ${amount} หน่วยสำเร็จ! เครดิตคงเหลือ: ${currentCredits} หน่วย`, 'success');
                }
            });
            
            // Add event listeners to credit options
            setTimeout(() => {
                document.querySelectorAll('.credit-option').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const amount = parseInt(this.dataset.amount);
                        document.getElementById('customCreditAmount').value = amount;
                    });
                });
            }, 100);
        }
        
        // Switch to simulation mode
        function switchToSimulationMode() {
            setMode('simulation');
            creditWarning.classList.add('hidden');
            createVideoBtn.disabled = false;
            showAlert('เปลี่ยนเป็นโหมดจำลอง (ฟรี) แล้ว', 'success');
        }
        
        // Update progress
        function updateProgress(percent, title, message, status = 'loading') {
            progressBar.style.width = `${percent}%`;
            progressText.textContent = `${Math.round(percent)}%`;
            statusTitle.textContent = title;
            statusMessage.textContent = message;
            statusDetail.textContent = message;
            
            // Update icon
            statusIcon.innerHTML = '';
            if (status === 'loading') {
                statusIcon.innerHTML = '<i class="fas fa-sync-alt rotate text-blue-400"></i>';
                timeEstimate.textContent = 'ประมาณ 45 วินาที';
            } else if (status === 'success') {
                statusIcon.innerHTML = '<i class="fas fa-check-circle text-green-400"></i>';
                timeEstimate.textContent = 'สำเร็จ';
            } else if (status === 'error') {
                statusIcon.innerHTML = '<i class="fas fa-exclamation-circle text-red-400"></i>';
                timeEstimate.textContent = 'ผิดพลาด';
            }
        }
        
        // Clear prompt
        function clearPrompt() {
            promptInput.value = '';
            updateCharCount();
            promptInput.focus();
        }
        
        // Copy API Key
        function copyApiKey() {
            navigator.clipboard.writeText(apiKeyInput.value).then(() => {
                showAlert('คัดลอก API Key เรียบร้อยแล้ว', 'success');
            });
        }
        
        // Copy API Response
        function copyApiResponse() {
            navigator.clipboard.writeText(apiResponseElement.textContent).then(() => {
                showAlert('คัดลอก API Response เรียบร้อยแล้ว', 'success');
            });
        }
        
        // Toggle video playback
        function toggleVideoPlayback() {
            if (videoPlayer.paused) {
                videoPlayer.play();
                playBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>หยุด';
            } else {
                videoPlayer.pause();
                playBtn.innerHTML = '<i class="fas fa-play mr-2"></i>เล่น';
            }
        }
        
        // Download video
        function downloadVideo() {
            if (!videoSource.src) {
                showAlert('ไม่มีวิดีโอให้ดาวน์โหลด', 'warning');
                return;
            }
            
            const link = document.createElement('a');
            link.href = videoSource.src;
            link.download = `genvdo_${Date.now()}.mp4`;
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert('เริ่มดาวน์โหลดวิดีโอแล้ว', 'success');
        }
        
        // Show alert
        function showAlert(message, type = 'info') {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                background: '#1f2937',
                color: '#f9fafb'
            });
            
            Toast.fire({
                icon: type,
                title: message
            });
        }
    </script>
</body>
</html>
