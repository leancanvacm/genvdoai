<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenVDO - สร้างวิดีโอจากข้อความด้วย AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Kanit', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
            100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }
        
        .video-card {
            transition: all 0.3s ease;
        }
        
        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .loading-dots:after {
            content: ' .';
            animation: dots 1.5s steps(5, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { color: rgba(0,0,0,0); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); }
            40% { color: white; text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); }
            60% { text-shadow: .25em 0 0 white, .5em 0 0 rgba(0,0,0,0); }
            80%, 100% { text-shadow: .25em 0 0 white, .5em 0 0 white; }
        }
        
        .blink {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .rotate {
            animation: rotate 2s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="text-center mb-10 slide-in">
            <div class="flex justify-center items-center mb-4">
                <div class="gradient-bg p-4 rounded-full mr-4">
                    <i class="fas fa-video text-3xl text-white"></i>
                </div>
                <div>
                    <h1 class="text-5xl font-bold gradient-text mb-2">GenVDO</h1>
                    <p class="text-gray-400 text-lg">สร้างวิดีโอจากข้อความด้วย AI - API เวอร์ชันใหม่</p>
                </div>
            </div>
            <div class="inline-flex items-center bg-gray-800 px-4 py-2 rounded-full">
                <i class="fas fa-code text-yellow-400 mr-2"></i>
                <span class="text-sm">ใช้ API: <code class="ml-1 text-blue-300">/api/v1/jobs/recordInfo</code></span>
            </div>
        </header>

        <!-- Main Content -->
        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Left Column: Input Form -->
            <div class="bg-gray-800 rounded-2xl p-6 shadow-2xl video-card">
                <h2 class="text-2xl font-bold text-blue-300 mb-6 border-b border-gray-700 pb-3 flex items-center">
                    <i class="fas fa-cogs mr-3"></i>ตั้งค่าการสร้างวิดีโอ
                </h2>
                
                <!-- API Key Display -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-gray-300 font-medium">
                            <i class="fas fa-key mr-2"></i>API Key ของคุณ
                        </label>
                        <span class="text-xs text-green-400 bg-green-900 px-2 py-1 rounded">
                            <i class="fas fa-check mr-1"></i>พร้อมใช้งาน
                        </span>
                    </div>
                    <div class="relative">
                        <input 
                            type="text" 
                            id="apiKey" 
                            readonly
                            value="10757e71946cb1a904cf4c2632f221ce"
                            class="w-full p-4 pl-12 bg-gray-700 border-2 border-green-600 rounded-xl focus:outline-none"
                        >
                        <i class="fas fa-key absolute left-4 top-1/2 transform -translate-y-1/2 text-green-400"></i>
                        <button 
                            id="copyApiKey"
                            class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-green-300"
                            type="button"
                            title="คัดลอก API Key"
                        >
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <p class="text-gray-400 text-sm mt-2">
                        <i class="fas fa-info-circle mr-1"></i>API Key นี้ถูกตั้งค่าให้พร้อมใช้งานทันที
                    </p>
                </div>
                
                <!-- Task ID Input -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-gray-300 font-medium">
                            <i class="fas fa-barcode mr-2"></i>Task ID
                        </label>
                        <button id="generateTaskId" class="text-xs gradient-bg text-white px-3 py-1 rounded-lg hover:opacity-90">
                            <i class="fas fa-plus mr-1"></i>สร้างใหม่
                        </button>
                    </div>
                    <div class="relative">
                        <input 
                            type="text" 
                            id="taskId" 
                            placeholder="task_xxxxxxxx"
                            value="task_12345678"
                            class="w-full p-4 pl-12 bg-gray-700 border-2 border-gray-600 rounded-xl focus:outline-none focus:border-blue-500 transition"
                        >
                        <i class="fas fa-hashtag absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                    <p class="text-gray-400 text-sm mt-2">
                        <i class="fas fa-lightbulb mr-1"></i>Task ID สำหรับดึงข้อมูลวิดีโอจากเซิร์ฟเวอร์
                    </p>
                </div>
                
                <!-- Prompt Input (สำหรับแสดงผล) -->
                <div class="mb-6">
                    <label class="block text-gray-300 mb-2 font-medium">
                        <i class="fas fa-comment-dots mr-2"></i>คำอธิบายวิดีโอ (สำหรับอ้างอิง)
                    </label>
                    <div class="relative">
                        <textarea 
                            id="prompt" 
                            rows="4" 
                            placeholder="อธิบายวิดีโอที่ต้องการดึงข้อมูล..."
                            class="w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-xl focus:outline-none focus:border-blue-500 transition resize-none"
                        >ทะเลที่สงบภายใต้แสงจันทร์ในคืนพระจันทร์เต็มดวง มีเรือใบลอยอยู่เบื้องหน้า</textarea>
                        <div class="absolute bottom-3 right-3">
                            <i class="fas fa-pen text-gray-400"></i>
                        </div>
                    </div>
                    <div class="mt-3 flex flex-wrap gap-2">
                        <button class="prompt-example px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm transition" data-prompt="หมีแพนด้ากำลังกินใบไผ่ในป่าไผ่ที่มีแสงแดดส่องผ่าน">
                            แพนด้าน่ารัก
                        </button>
                        <button class="prompt-example px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm transition" data-prompt="เมืองไซเบอร์พังก์ในยามค่ำคืน มีฝนตกและรถยนต์บินได้วิ่งบนถนน">
                            ไซเบอร์พังก์
                        </button>
                        <button class="prompt-example px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm transition" data-prompt="ดอกซากุระบานสะพรั่งในฤดูใบไม้ผลิ ลมพัดโบกสะบัดกลีบดอกไม้">
                            ซากุระญี่ปุ่น
                        </button>
                    </div>
                </div>
                
                <!-- Video Information Section -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-300 mb-4 flex items-center">
                        <i class="fas fa-info-circle mr-3"></i>ข้อมูลวิดีโอ
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="bg-gray-900 p-3 rounded-lg">
                            <div class="flex items-center text-gray-400 text-sm mb-2">
                                <i class="fas fa-expand-alt mr-2"></i>
                                <span>สัดส่วนวิดีโอ</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-300">Landscape (16:9)</span>
                                <span class="text-green-400">
                                    <i class="fas fa-check"></i>
                                </span>
                            </div>
                        </div>
                        
                        <div class="bg-gray-900 p-3 rounded-lg">
                            <div class="flex items-center text-gray-400 text-sm mb-2">
                                <i class="fas fa-film mr-2"></i>
                                <span>จำนวนเฟรม</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-300">20 เฟรม</span>
                                <span class="text-blue-400">
                                    <i class="fas fa-film"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Status Display -->
                    <div id="videoStatusInfo" class="bg-gray-900 p-4 rounded-lg">
                        <div class="flex items-center">
                            <div class="mr-3 text-2xl text-yellow-400">
                                <i class="fas fa-hourglass-half"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-300">สถานะวิดีโอ</h4>
                                <p class="text-gray-400 text-sm">รอการดึงข้อมูลจากเซิร์ฟเวอร์</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="space-y-4">
                    <button 
                        id="fetchVideoBtn"
                        class="w-full gradient-bg text-white font-bold py-4 px-6 rounded-xl text-lg transition-all duration-300 transform hover:scale-[1.02] pulse-animation flex items-center justify-center"
                    >
                        <i class="fas fa-cloud-download-alt mr-3 text-xl"></i>
                        <span>ดึงข้อมูลวิดีโอ</span>
                    </button>
                    
                    <button 
                        id="testApiBtn"
                        class="w-full bg-blue-800 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition flex items-center justify-center"
                    >
                        <i class="fas fa-vial mr-3"></i>
                        <span>ทดสอบการเชื่อมต่อ API</span>
                    </button>
                </div>
            </div>
            
            <!-- Right Column: Output & Preview -->
            <div class="bg-gray-800 rounded-2xl p-6 shadow-2xl video-card">
                <h2 class="text-2xl font-bold text-green-300 mb-6 border-b border-gray-700 pb-3 flex items-center">
                    <i class="fas fa-video mr-3"></i>ผลลัพธ์วิดีโอ
                </h2>
                
                <!-- Status Display -->
                <div id="statusContainer" class="mb-6 hidden">
                    <div class="bg-gray-700 rounded-xl p-5 border-l-4 border-blue-500">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center">
                                <div id="statusIcon" class="text-2xl mr-3">
                                    <i class="fas fa-sync-alt rotate text-blue-400"></i>
                                </div>
                                <div>
                                    <h4 id="statusTitle" class="font-bold text-lg">กำลังดึงข้อมูลวิดีโอ</h4>
                                    <p id="statusMessage" class="text-gray-400 text-sm">กำลังเชื่อมต่อกับเซิร์ฟเวอร์ KIE.AI</p>
                                </div>
                            </div>
                            <div id="statusProgress" class="text-right">
                                <span id="progressText" class="text-blue-400 font-bold text-xl">0%</span>
                            </div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="w-full bg-gray-600 rounded-full h-2 mb-2">
                            <div id="progressBar" class="progress-bar rounded-full" style="width: 0%"></div>
                        </div>
                        
                        <div class="flex justify-between text-gray-400 text-sm">
                            <span id="statusDetail">เริ่มต้นการเชื่อมต่อ...</span>
                            <span id="timeEstimate">ประมาณ 5-10 วินาที</span>
                        </div>
                    </div>
                    
                    <!-- Task Info Display -->
                    <div id="taskInfoContainer" class="mt-4 bg-gray-900 p-4 rounded-lg hidden">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-database text-blue-400 mr-2"></i>
                            <span class="text-sm text-gray-300 font-medium">ข้อมูล Task:</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="text-gray-400">Task ID:</div>
                            <div class="text-gray-300 font-mono" id="displayTaskId">-</div>
                            <div class="text-gray-400">สถานะ:</div>
                            <div class="text-yellow-300" id="displayStatus">-</div>
                            <div class="text-gray-400">สร้างเมื่อ:</div>
                            <div class="text-gray-300" id="displayCreated">-</div>
                            <div class="text-gray-400">อัพเดตล่าสุด:</div>
                            <div class="text-gray-300" id="displayUpdated">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- Video Preview -->
                <div id="videoPreview" class="video-container mb-8 hidden fade-in">
                    <div class="mb-4 flex justify-between items-center">
                        <h3 class="text-xl font-bold text-gray-300">วิดีโอที่ดึงข้อมูลสำเร็จ!</h3>
                        <div class="flex space-x-2">
                            <button 
                                id="playBtn"
                                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition flex items-center"
                            >
                                <i class="fas fa-play mr-2"></i>เล่น
                            </button>
                            <button 
                                id="downloadBtn"
                                class="px-4 py-2 gradient-bg text-white rounded-lg font-medium transition flex items-center"
                            >
                                <i class="fas fa-download mr-2"></i>ดาวน์โหลด
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-gray-900 rounded-xl overflow-hidden border-2 border-gray-700">
                        <video 
                            id="generatedVideo" 
                            class="w-full h-auto max-h-80 object-contain" 
                            controls
                            poster="https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                        >
                            <source id="videoSource" src="" type="video/mp4">
                            เบราว์เซอร์ของคุณไม่รองรับการเล่นวิดีโอ
                        </video>
                        <div class="p-3 bg-gray-800 text-center text-gray-400 text-sm">
                            <i class="fas fa-info-circle mr-1"></i>
                            วิดีโอถูกสร้างจาก AI โดยใช้โมเดล Sora-2
                        </div>
                    </div>
                    
                    <!-- Video Info -->
                    <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-gray-900 p-4 rounded-lg">
                            <div class="flex items-center text-gray-400 text-sm mb-3">
                                <i class="fas fa-info-circle mr-2"></i>
                                <span>ข้อมูลวิดีโอ</span>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">ขนาด:</span>
                                    <span id="videoSize" class="text-gray-300 font-medium">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">ระยะเวลา:</span>
                                    <span id="videoDuration" class="text-gray-300 font-medium">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">รูปแบบ:</span>
                                    <span class="text-gray-300 font-medium">MP4</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-900 p-4 rounded-lg">
                            <div class="flex items-center text-gray-400 text-sm mb-3">
                                <i class="fas fa-history mr-2"></i>
                                <span>เวลาในการประมวลผล</span>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">เริ่มต้น:</span>
                                    <span id="startTime" class="text-gray-300 font-medium">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">สิ้นสุด:</span>
                                    <span id="endTime" class="text-gray-300 font-medium">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">ทั้งหมด:</span>
                                    <span id="processTime" class="text-green-300 font-medium">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-900 p-4 rounded-lg">
                            <div class="flex items-center text-gray-400 text-sm mb-3">
                                <i class="fas fa-server mr-2"></i>
                                <span>ข้อมูลเซิร์ฟเวอร์</span>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">API:</span>
                                    <span class="text-blue-300 font-medium">KIE.AI</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">รุ่นโมเดล:</span>
                                    <span class="text-gray-300 font-medium">Sora-2</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">สถานะ:</span>
                                    <span id="apiStatus" class="text-green-300 font-medium">พร้อมใช้งาน</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- API Response Data -->
                <div id="apiResponseContainer" class="mt-6 hidden">
                    <h3 class="text-xl font-bold text-gray-300 mb-4 flex items-center">
                        <i class="fas fa-code mr-3"></i>ข้อมูลจาก API Response
                    </h3>
                    <div class="bg-gray-900 rounded-xl p-4">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-gray-400 text-sm">JSON Response:</span>
                            <button id="copyResponseBtn" class="text-xs bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded">
                                <i class="fas fa-copy mr-1"></i>คัดลอก
                            </button>
                        </div>
                        <pre id="apiResponse" class="text-xs text-gray-300 bg-gray-800 p-3 rounded-lg overflow-auto max-h-60"></pre>
                    </div>
                </div>
                
                <!-- Placeholder when no video -->
                <div id="videoPlaceholder" class="text-center py-16 bg-gray-900 rounded-2xl border-2 border-dashed border-gray-700">
                    <div class="text-gray-500 mb-4">
                        <i class="fas fa-cloud-download-alt text-7xl blink"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-500 mb-2">พร้อมดึงข้อมูลวิดีโอ</h3>
                    <p class="text-gray-600 max-w-md mx-auto mb-6">ป้อน Task ID และกด "ดึงข้อมูลวิดีโอ" เพื่อแสดงผลวิดีโอจากเซิร์ฟเวอร์</p>
                    <div class="flex justify-center space-x-3">
                        <div class="w-4 h-4 bg-blue-500 rounded-full animate-pulse"></div>
                        <div class="w-4 h-4 bg-purple-500 rounded-full animate-pulse" style="animation-delay: 0.2s"></div>
                        <div class="w-4 h-4 bg-green-500 rounded-full animate-pulse" style="animation-delay: 0.4s"></div>
                    </div>
                </div>
                
                <!-- Sample Task IDs -->
                <div class="mt-8">
                    <h3 class="text-xl font-bold text-gray-300 mb-4 flex items-center">
                        <i class="fas fa-list-alt mr-3"></i>ตัวอย่าง Task ID
                    </h3>
                    <div class="space-y-2">
                        <button class="task-example w-full text-left p-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition flex justify-between items-center" data-taskid="task_12345678">
                            <div>
                                <div class="text-blue-300 font-medium">task_12345678</div>
                                <div class="text-gray-400 text-sm">ทะเลที่สงบภายใต้แสงจันทร์</div>
                            </div>
                            <i class="fas fa-chevron-right text-gray-500"></i>
                        </button>
                        <button class="task-example w-full text-left p-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition flex justify-between items-center" data-taskid="task_87654321">
                            <div>
                                <div class="text-blue-300 font-medium">task_87654321</div>
                                <div class="text-gray-400 text-sm">เมืองอนาคตในเวลากลางคืน</div>
                            </div>
                            <i class="fas fa-chevron-right text-gray-500"></i>
                        </button>
                        <button class="task-example w-full text-left p-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition flex justify-between items-center" data-taskid="task_abcdefgh">
                            <div>
                                <div class="text-blue-300 font-medium">task_abcdefgh</div>
                                <div class="text-gray-400 text-sm">ภูเขาที่ปกคลุมด้วยหิมะ</div>
                            </div>
                            <i class="fas fa-chevron-right text-gray-500"></i>
                        </button>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="mt-12 text-center text-gray-500 text-sm border-t border-gray-800 pt-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p class="flex items-center justify-center md:justify-start">
                        <i class="fas fa-code mr-2"></i>
                        ใช้ API: <code class="mx-2 text-blue-300">/api/v1/jobs/recordInfo</code>
                    </p>
                </div>
                <div>
                    <p class="flex items-center justify-center md:justify-end">
                        <i class="fas fa-sync-alt mr-2"></i>
                        เวอร์ชัน: <span class="ml-1 text-green-400">2.0</span>
                    </p>
                </div>
            </div>
            <p class="mt-4">© 2023 GenVDO - ดึงข้อมูลวิดีโอจาก Task ID ด้วย API ใหม่</p>
        </footer>
    </div>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // DOM Elements
        const apiKeyInput = document.getElementById('apiKey');
        const taskIdInput = document.getElementById('taskId');
        const promptInput = document.getElementById('prompt');
        const fetchVideoBtn = document.getElementById('fetchVideoBtn');
        const testApiBtn = document.getElementById('testApiBtn');
        const generateTaskIdBtn = document.getElementById('generateTaskId');
        const copyApiKeyBtn = document.getElementById('copyApiKey');
        const statusContainer = document.getElementById('statusContainer');
        const videoPreview = document.getElementById('videoPreview');
        const videoPlaceholder = document.getElementById('videoPlaceholder');
        const generatedVideo = document.getElementById('generatedVideo');
        const videoSource = document.getElementById('videoSource');
        const playBtn = document.getElementById('playBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const statusTitle = document.getElementById('statusTitle');
        const statusMessage = document.getElementById('statusMessage');
        const statusDetail = document.getElementById('statusDetail');
        const timeEstimate = document.getElementById('timeEstimate');
        const statusIcon = document.getElementById('statusIcon');
        const taskInfoContainer = document.getElementById('taskInfoContainer');
        const apiResponseContainer = document.getElementById('apiResponseContainer');
        const apiResponseElement = document.getElementById('apiResponse');
        const copyResponseBtn = document.getElementById('copyResponseBtn');
        const taskExampleButtons = document.querySelectorAll('.task-example');
        const promptExampleButtons = document.querySelectorAll('.prompt-example');
        const videoStatusInfo = document.getElementById('videoStatusInfo');
        
        // Display elements
        const displayTaskId = document.getElementById('displayTaskId');
        const displayStatus = document.getElementById('displayStatus');
        const displayCreated = document.getElementById('displayCreated');
        const displayUpdated = document.getElementById('displayUpdated');
        const videoSize = document.getElementById('videoSize');
        const videoDuration = document.getElementById('videoDuration');
        const startTime = document.getElementById('startTime');
        const endTime = document.getElementById('endTime');
        const processTime = document.getElementById('processTime');
        const apiStatus = document.getElementById('apiStatus');
        
        // State variables
        let currentTaskId = null;
        let startTimestamp = null;
        
        // Sample video URLs for demonstration
        const sampleVideos = {
            'task_12345678': {
                videoUrl: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
                status: 'completed',
                created: '2023-10-01T10:30:00Z',
                updated: '2023-10-01T10:35:00Z',
                duration: 60,
                size: '125 MB'
            },
            'task_87654321': {
                videoUrl: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4',
                status: 'completed',
                created: '2023-10-02T14:20:00Z',
                updated: '2023-10-02T14:25:00Z',
                duration: 30,
                size: '65 MB'
            },
            'task_abcdefgh': {
                videoUrl: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerMeltdowns.mp4',
                status: 'completed',
                created: '2023-10-03T09:15:00Z',
                updated: '2023-10-03T09:20:00Z',
                duration: 45,
                size: '95 MB'
            }
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial timestamp
            startTime.textContent = new Date().toLocaleTimeString('th-TH');
            
            // Set up event listeners
            setupEventListeners();
            
            // Show initial info
            showAlert('ระบบพร้อมใช้งาน! ป้อน Task ID เพื่อดึงข้อมูลวิดีโอ', 'info');
        });
        
        // Setup all event listeners
        function setupEventListeners() {
            // Fetch video button
            fetchVideoBtn.addEventListener('click', fetchVideoData);
            
            // Test API button
            testApiBtn.addEventListener('click', testApiConnection);
            
            // Generate Task ID button
            generateTaskIdBtn.addEventListener('click', generateNewTaskId);
            
            // Copy API Key button
            copyApiKeyBtn.addEventListener('click', copyApiKey);
            
            // Copy Response button
            copyResponseBtn.addEventListener('click', copyApiResponse);
            
            // Play button
            playBtn.addEventListener('click', toggleVideoPlayback);
            
            // Download button
            downloadBtn.addEventListener('click', downloadVideo);
            
            // Task example buttons
            taskExampleButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const taskId = this.dataset.taskid;
                    taskIdInput.value = taskId;
                    
                    // Update prompt based on selected task
                    if (taskId === 'task_12345678') {
                        promptInput.value = 'ทะเลที่สงบภายใต้แสงจันทร์ในคืนพระจันทร์เต็มดวง มีเรือใบลอยอยู่เบื้องหน้า';
                    } else if (taskId === 'task_87654321') {
                        promptInput.value = 'เมืองอนาคตในเวลากลางคืน รถยนต์บินได้วิ่งไปมาบนท้องฟ้า มีแสงสีสันจากอาคารสูง';
                    } else if (taskId === 'task_abcdefgh') {
                        promptInput.value = 'ภูเขาที่ปกคลุมด้วยหิมะสีขาว พระอาทิตย์ขึ้นด้านหลังภูเขา สร้างบรรยากาศที่สวยงาม';
                    }
                    
                    showAlert(`เลือก Task ID: ${taskId}`, 'success');
                });
            });
            
            // Prompt example buttons
            promptExampleButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    promptInput.value = this.dataset.prompt;
                });
            });
            
            // Video ended event
            generatedVideo.addEventListener('ended', function() {
                playBtn.innerHTML = '<i class="fas fa-play mr-2"></i>เล่น';
            });
        }
        
        // Fetch video data using the new API
        async function fetchVideoData() {
            const apiKey = apiKeyInput.value.trim();
            const taskId = taskIdInput.value.trim();
            
            // Validation
            if (!apiKey) {
                showAlert('กรุณาตรวจสอบ API Key', 'error');
                return;
            }
            
            if (!taskId) {
                showAlert('กรุณาป้อน Task ID', 'error');
                taskIdInput.focus();
                return;
            }
            
            if (!taskId.startsWith('task_')) {
                showAlert('Task ID ควรเริ่มต้นด้วย "task_"', 'warning');
            }
            
            // Show loading state
            fetchVideoBtn.disabled = true;
            fetchVideoBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>กำลังดึงข้อมูล...';
            
            // Show status container
            statusContainer.classList.remove('hidden');
            videoPreview.classList.add('hidden');
            videoPlaceholder.classList.add('hidden');
            apiResponseContainer.classList.add('hidden');
            
            // Reset and start progress
            startTimestamp = new Date();
            updateProgress(10, 'กำลังเชื่อมต่อ API...', 'เริ่มต้นการดึงข้อมูลวิดีโอ');
            
            try {
                // REAL API CALL using the new endpoint
                const apiUrl = `https://api.kie.ai/api/v1/jobs/recordInfo?taskId=${encodeURIComponent(taskId)}`;
                
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                updateProgress(40, 'ได้รับข้อมูลจากเซิร์ฟเวอร์', 'กำลังประมวลผลข้อมูล...');
                
                if (!response.ok) {
                    // Check if this is a sample task ID
                    if (sampleVideos[taskId]) {
                        // Use sample data for demonstration
                        await simulateApiResponse(taskId);
                        return;
                    }
                    
                    throw new Error(`API Error: ${response.status} - ${response.statusText}`);
                }
                
                const result = await response.json();
                
                updateProgress(80, 'ประมวลผลข้อมูลสำเร็จ', 'กำลังเตรียมแสดงผล...');
                
                // Log result to console as requested
                console.log('API Response:', result);
                
                // Display API response
                displayApiResponse(result);
                
                // Process and display video data
                await processVideoData(result, taskId);
                
                updateProgress(100, 'ดึงข้อมูลสำเร็จ!', 'วิดีโอพร้อมแสดงผล', 'success');
                
                // Show video after a short delay
                setTimeout(() => {
                    statusContainer.classList.add('hidden');
                    videoPreview.classList.remove('hidden');
                    videoPreview.classList.add('fade-in');
                    apiResponseContainer.classList.remove('hidden');
                    
                    // Update end time
                    const endTimestamp = new Date();
                    endTime.textContent = endTimestamp.toLocaleTimeString('th-TH');
                    
                    // Calculate and display process time
                    const processSeconds = Math.round((endTimestamp - startTimestamp) / 1000);
                    processTime.textContent = `${processSeconds} วินาที`;
                    
                    showAlert(`ดึงข้อมูลวิดีโอสำเร็จ! (ใช้เวลา ${processSeconds} วินาที)`, 'success');
                }, 1000);
                
            } catch (error) {
                console.error('Error fetching video data:', error);
                
                // Try to use sample data if available
                if (sampleVideos[taskId]) {
                    updateProgress(60, 'ใช้ข้อมูลตัวอย่าง', 'API ไม่สามารถเชื่อมต่อได้ ใช้ข้อมูลตัวอย่างแทน');
                    
                    setTimeout(async () => {
                        await simulateApiResponse(taskId);
                        updateProgress(100, 'ใช้ข้อมูลตัวอย่างสำเร็จ', 'แสดงผลวิดีโอจากข้อมูลตัวอย่าง', 'success');
                        
                        setTimeout(() => {
                            statusContainer.classList.add('hidden');
                            videoPreview.classList.remove('hidden');
                            apiResponseContainer.classList.remove('hidden');
                            showAlert('ใช้ข้อมูลตัวอย่างเนื่องจาก API มีปัญหา', 'warning');
                        }, 1000);
                    }, 2000);
                    return;
                }
                
                updateProgress(0, 'เกิดข้อผิดพลาด', error.message || 'ไม่สามารถดึงข้อมูลได้', 'error');
                
                // Reset after error
                setTimeout(() => {
                    resetUI();
                    showAlert('ไม่สามารถดึงข้อมูลวิดีโอได้ กรุณาตรวจสอบ Task ID และ API Key', 'error');
                }, 3000);
                
            } finally {
                fetchVideoBtn.disabled = false;
                fetchVideoBtn.innerHTML = '<i class="fas fa-cloud-download-alt mr-3 text-xl"></i><span>ดึงข้อมูลวิดีโอ</span>';
            }
        }
        
        // Simulate API response for sample task IDs
        async function simulateApiResponse(taskId) {
            const sampleData = sampleVideos[taskId];
            
            if (!sampleData) {
                throw new Error('ไม่พบข้อมูลสำหรับ Task ID นี้');
            }
            
            // Create simulated API response
            const simulatedResponse = {
                success: true,
                taskId: taskId,
                status: sampleData.status,
                videoUrl: sampleData.videoUrl,
                createdAt: sampleData.created,
                updatedAt: sampleData.updated,
                metadata: {
                    duration: sampleData.duration,
                    fileSize: sampleData.size,
                    format: 'MP4',
                    aspectRatio: '16:9',
                    model: 'sora-2-text-to-video'
                }
            };
            
            // Display API response
            displayApiResponse(simulatedResponse);
            
            // Process and display video data
            await processVideoData(simulatedResponse, taskId);
            
            // Update video status info
            videoStatusInfo.innerHTML = `
                <div class="flex items-center">
                    <div class="mr-3 text-2xl text-green-400">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-300">สถานะวิดีโอ</h4>
                        <p class="text-gray-400 text-sm">พร้อมแสดงผล (ข้อมูลตัวอย่าง)</p>
                    </div>
                </div>
            `;
        }
        
        // Process and display video data
        async function processVideoData(result, taskId) {
            currentTaskId = taskId;
            
            // Update task info display
            displayTaskId.textContent = taskId;
            displayStatus.textContent = result.status || 'unknown';
            displayStatus.className = result.status === 'completed' ? 'text-green-300' : 'text-yellow-300';
            
            if (result.createdAt) {
                displayCreated.textContent = new Date(result.createdAt).toLocaleString('th-TH');
            }
            
            if (result.updatedAt) {
                displayUpdated.textContent = new Date(result.updatedAt).toLocaleString('th-TH');
            }
            
            // Show task info container
            taskInfoContainer.classList.remove('hidden');
            
            // Set video source
            const videoUrl = result.videoUrl || (result.metadata && result.metadata.videoUrl);
            
            if (videoUrl) {
                videoSource.src = videoUrl;
                generatedVideo.load();
                
                // Wait for video metadata to load
                return new Promise((resolve) => {
                    generatedVideo.addEventListener('loadedmetadata', function() {
                        // Update video info
                        videoDuration.textContent = `${Math.round(this.duration)} วินาที`;
                        
                        // Get file size from metadata or simulate
                        if (result.metadata && result.metadata.fileSize) {
                            videoSize.textContent = result.metadata.fileSize;
                        } else {
                            // Simulate file size based on duration
                            const simulatedSize = Math.round(this.duration * 2 * 1024); // Simulated KB
                            videoSize.textContent = simulatedSize > 1024 
                                ? `${(simulatedSize / 1024).toFixed(1)} MB` 
                                : `${simulatedSize} KB`;
                        }
                        
                        // Set up download button
                        downloadBtn.onclick = () => downloadVideoFile(videoUrl, taskId);
                        
                        resolve();
                    });
                    
                    // Fallback in case metadata doesn't load
                    setTimeout(resolve, 2000);
                });
            } else {
                throw new Error('ไม่พบ URL วิดีโอในข้อมูลที่ได้รับ');
            }
        }
        
        // Display API response
        function displayApiResponse(data) {
            apiResponseElement.textContent = JSON.stringify(data, null, 2);
            apiResponseContainer.classList.remove('hidden');
        }
        
        // Test API connection
        async function testApiConnection() {
            const apiKey = apiKeyInput.value.trim();
            
            if (!apiKey) {
                showAlert('กรุณาตรวจสอบ API Key', 'error');
                return;
            }
            
            testApiBtn.disabled = true;
            testApiBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>กำลังทดสอบ...';
            
            try {
                // Test with a sample task ID
                const testTaskId = 'task_12345678';
                const apiUrl = `https://api.kie.ai/api/v1/jobs/recordInfo?taskId=${encodeURIComponent(testTaskId)}`;
                
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    apiStatus.textContent = 'พร้อมใช้งาน';
                    apiStatus.className = 'text-green-300 font-medium';
                    showAlert('การเชื่อมต่อ API สำเร็จ!', 'success');
                } else {
                    apiStatus.textContent = 'มีปัญหา';
                    apiStatus.className = 'text-yellow-300 font-medium';
                    showAlert('API ตอบสนองแต่มีข้อผิดพลาด', 'warning');
                }
                
            } catch (error) {
                console.error('API Test Error:', error);
                apiStatus.textContent = 'ไม่สามารถเชื่อมต่อ';
                apiStatus.className = 'text-red-300 font-medium';
                showAlert('ไม่สามารถเชื่อมต่อกับ API ได้', 'error');
            } finally {
                testApiBtn.disabled = false;
                testApiBtn.innerHTML = '<i class="fas fa-vial mr-3"></i><span>ทดสอบการเชื่อมต่อ API</span>';
            }
        }
        
        // Generate new Task ID
        function generateNewTaskId() {
            const timestamp = Date.now();
            const randomNum = Math.floor(Math.random() * 100000000);
            const newTaskId = `task_${timestamp.toString().slice(-8)}${randomNum.toString().slice(-4)}`;
            
            taskIdInput.value = newTaskId;
            
            // Also update prompt to match
            promptInput.value = 'วิดีโอใหม่ที่กำลังสร้างด้วย AI จากข้อความคำอธิบาย';
            
            showAlert(`สร้าง Task ID ใหม่: ${newTaskId}`, 'success');
        }
        
        // Copy API Key
        function copyApiKey() {
            navigator.clipboard.writeText(apiKeyInput.value).then(() => {
                showAlert('คัดลอก API Key เรียบร้อยแล้ว', 'success');
            });
        }
        
        // Copy API Response
        function copyApiResponse() {
            navigator.clipboard.writeText(apiResponseElement.textContent).then(() => {
                showAlert('คัดลอกข้อมูล API Response เรียบร้อยแล้ว', 'success');
            });
        }
        
        // Toggle video playback
        function toggleVideoPlayback() {
            if (generatedVideo.paused) {
                generatedVideo.play();
                playBtn.innerHTML = '<i class="fas fa-pause mr-2"></i>หยุด';
            } else {
                generatedVideo.pause();
                playBtn.innerHTML = '<i class="fas fa-play mr-2"></i>เล่น';
            }
        }
        
        // Download video
        function downloadVideo() {
            if (videoSource.src) {
                downloadVideoFile(videoSource.src, currentTaskId || 'genvdo_video');
            } else {
                showAlert('ไม่มีวิดีโอให้ดาวน์โหลด', 'warning');
            }
        }
        
        // Download video file
        function downloadVideoFile(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = `${filename}.mp4`;
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert('เริ่มดาวน์โหลดวิดีโอแล้ว', 'success');
        }
        
        // Update progress display
        function updateProgress(percent, title, message, status = 'loading') {
            progressBar.style.width = `${percent}%`;
            progressText.textContent = `${Math.round(percent)}%`;
            statusTitle.textContent = title;
            statusMessage.textContent = message;
            statusDetail.textContent = message;
            
            // Update icon based on status
            statusIcon.innerHTML = '';
            if (status === 'loading') {
                statusIcon.innerHTML = '<i class="fas fa-sync-alt rotate text-blue-400"></i>';
                timeEstimate.textContent = 'ประมาณ 5-10 วินาที';
            } else if (status === 'success') {
                statusIcon.innerHTML = '<i class="fas fa-check-circle text-green-400"></i>';
                timeEstimate.textContent = 'เสร็จสิ้น';
            } else if (status === 'error') {
                statusIcon.innerHTML = '<i class="fas fa-exclamation-circle text-red-400"></i>';
                timeEstimate.textContent = 'เกิดข้อผิดพลาด';
            }
        }
        
        // Reset UI
        function resetUI() {
            statusContainer.classList.add('hidden');
            videoPreview.classList.add('hidden');
            videoPlaceholder.classList.remove('hidden');
            taskInfoContainer.classList.add('hidden');
            apiResponseContainer.classList.add('hidden');
            fetchVideoBtn.disabled = false;
            fetchVideoBtn.innerHTML = '<i class="fas fa-cloud-download-alt mr-3 text-xl"></i><span>ดึงข้อมูลวิดีโอ</span>';
        }
        
        // Show alert using SweetAlert2
        function showAlert(message, type = 'info') {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer);
                    toast.addEventListener('mouseleave', Swal.resumeTimer);
                }
            });
            
            Toast.fire({
                icon: type,
                title: message,
                background: '#1f2937',
                color: '#f9fafb'
            });
        }
    </script>
</body>
</html>
